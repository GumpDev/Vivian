<html>
    <head>
        <title>Vivian</title>
    </head>
    <body>
        <video autoplay id="preview" width="640" height="480"></video>
        <br/>
        <canvas id="canvas" style="display: none;"></canvas>
        <br/>
        <button onclick="tirarFoto()" style="width: 100%; height: 200px; border: 1px solid white; background-color: #232323; color: white">Tirar</button>
        <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
        <script>
            const preview = document.getElementById("preview");
            const canvas = document.getElementById("canvas");
            let webcam = null; 
            navigator.getMedia = ( navigator.getUserMedia ||
                       navigator.webkitGetUserMedia ||
                       navigator.mozGetUserMedia ||
                       navigator.msGetUserMedia);

            document.onload = () =>{
                webcam = new Webcam(preview, 'user', canvas, null);
                webcam.start();
            }
 
            function tirarFoto(){
                webcam.snap();
                const dataURL = canvas.toDataURL('image/jpeg');
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(xhttp.responseText);
                    }
                };
                xhttp.open("POST", "/upload", true);
                xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                xhttp.send("file="+encodeURIComponent(dataURL));
            }
        </script>
    </body>
</html>